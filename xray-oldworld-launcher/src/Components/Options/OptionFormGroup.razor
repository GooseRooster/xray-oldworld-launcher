@using XrayOldworldLauncher.Models.Options
@using XrayOldworldLauncher.Services

@inject OptionsStateService StateService

<MudPaper Class="pa-4 mb-3" Elevation="1">
    <MudText Typo="Typo.h6" Class="mb-3">@Group.Label</MudText>

    @foreach (var opt in Group.Options)
    {
        <OptionControl Definition="@opt"
                       Value="@StateService.GetCurrentValue(opt, PageId, Group.Id)"
                       ValueChanged="@(v => OnOptionChanged(opt, v))" />
    }
</MudPaper>

@code {
    [Parameter] public OptionGroup Group { get; set; } = null!;
    [Parameter] public string PageId { get; set; } = "";

    private void OnOptionChanged(OptionDefinition opt, string newValue)
    {
        StateService.SetPendingChange(opt, PageId, Group.Id, newValue);
        StateHasChanged();
    }
}
