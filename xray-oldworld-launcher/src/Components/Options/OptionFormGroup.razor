@using XrayOldworldLauncher.Models.Options
@using XrayOldworldLauncher.Services

@inject OptionsStateService StateService
@inject LocalizationService Loc

<div class="pa-4 mb-3">
    <MudText Typo="Typo.h6" Class="mb-3">@Loc.T($"group.{PageId}.{Group.Id}")</MudText>

    @foreach (var opt in Group.Options)
    {
        <OptionControl Definition="@opt"
                       Value="@StateService.GetCurrentValue(opt, PageId, Group.Id)"
                       ValueChanged="@(v => OnOptionChanged(opt, v))" />
    }
</div>

@code {
    [CascadingParameter(Name = "Language")] public string? Language { get; set; }
    [Parameter] public OptionGroup Group { get; set; } = null!;
    [Parameter] public string PageId { get; set; } = "";

    private void OnOptionChanged(OptionDefinition opt, string newValue)
    {
        StateService.SetPendingChange(opt, PageId, Group.Id, newValue);
        StateHasChanged();
    }
}
